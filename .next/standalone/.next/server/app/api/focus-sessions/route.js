(()=>{var e={};e.id=820,e.ids=[820],e.modules={2206:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>I,routeModule:()=>g,serverHooks:()=>v,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>y});var r={};s.r(r),s.d(r,{GET:()=>h,PATCH:()=>x,POST:()=>w});var n=s(96559),a=s(48088),i=s(37719),o=s(32190),u=s(7462),c=s(81310),l=s(45740),d=s(36781),p=s(44999);async function f(e){let t=await (0,p.UL)(),s=t.get("auth-token")?.value;if(!s)return null;try{return await (0,c.nr)(s)}catch{return null}}async function h(e){try{let t=await f(e);if(!t)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:s}=new URL(e.url),r=parseInt(s.get("page")||"1"),n=parseInt(s.get("limit")||"10"),a=s.get("startDate"),i=s.get("endDate"),c=`focus-sessions:${t.userId}:${r}:${n}:${a}:${i}`,l=await d.PP.get(c);if(l)return o.NextResponse.json(l);let p={userId:t.userId};(a||i)&&(p.startedAt={},a&&(p.startedAt.gte=new Date(a)),i&&(p.startedAt.lte=new Date(i)));let[h,w]=await Promise.all([u.z.focusSession.findMany({where:p,orderBy:{startedAt:"desc"},skip:(r-1)*n,take:n}),u.z.focusSession.count({where:p})]),x=await u.z.focusSession.aggregate({where:{userId:t.userId},_sum:{duration:!0,pauseCount:!0},_avg:{duration:!0},_count:!0}),g={sessions:h,pagination:{page:r,limit:n,total:w,totalPages:Math.ceil(w/n)},stats:{totalSessions:x._count,totalMinutes:x._sum.duration||0,avgDuration:Math.round(x._avg.duration||0),totalPauses:x._sum.pauseCount||0}};return await d.PP.set(c,g,120),o.NextResponse.json(g)}catch(e){return l.vF.error("Get focus sessions error",{error:e}),o.NextResponse.json({error:"Failed to fetch focus sessions"},{status:500})}}async function w(e){try{let t=await f(e);if(!t)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{taskId:s,duration:r=25,type:n="focus"}=await e.json(),a=await u.z.focusSession.findFirst({where:{userId:t.userId,endedAt:null}});if(a)return o.NextResponse.json({error:"You already have an active focus session",activeSession:a},{status:400});let i=await u.z.focusSession.create({data:{userId:t.userId,taskId:s,duration:r,type:n,startedAt:new Date}});return await d.PP.invalidatePattern(`focus-sessions:${t.userId}:*`),l.vF.info("Focus session started",{userId:t.userId,sessionId:i.id}),o.NextResponse.json({session:i},{status:201})}catch(e){return l.vF.error("Start focus session error",{error:e}),o.NextResponse.json({error:"Failed to start focus session"},{status:500})}}async function x(e){try{let t=await f(e);if(!t)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{sessionId:s,action:r,notes:n,pauseCount:a}=await e.json();if(!s)return o.NextResponse.json({error:"Session ID required"},{status:400});let i=await u.z.focusSession.findFirst({where:{id:s,userId:t.userId}});if(!i)return o.NextResponse.json({error:"Session not found"},{status:404});if("complete"===r||"cancel"===r){let e="complete"===r,c=e?Math.round((Date.now()-i.startedAt.getTime())/6e4):0,p=await u.z.focusSession.update({where:{id:s},data:{endedAt:new Date,completed:e,notes:n,pauseCount:a,duration:c}});return e&&c>0&&(await u.z.user.update({where:{id:t.userId},data:{totalFocusTime:{increment:c},experience:{increment:10*c}}}),i.taskId&&await u.z.task.update({where:{id:i.taskId},data:{totalFocusTime:{increment:c}}})),await d.PP.invalidatePattern(`focus-sessions:${t.userId}:*`),l.vF.info("Focus session ended",{userId:t.userId,sessionId:s,completed:e,duration:c}),o.NextResponse.json({session:p})}let c=await u.z.focusSession.update({where:{id:s},data:{notes:n,pauseCount:a}});return o.NextResponse.json({session:c})}catch(e){return l.vF.error("Update focus session error",{error:e}),o.NextResponse.json({error:"Failed to update focus session"},{status:500})}}let g=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/focus-sessions/route",pathname:"/api/focus-sessions",filename:"route",bundlePath:"app/api/focus-sessions/route"},resolvedPagePath:"/Users/ronakkumar/Desktop/make-it/Make_it/app/api/focus-sessions/route.ts",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:m,workUnitAsyncStorage:y,serverHooks:v}=g;function I(){return(0,i.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:y})}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7462:(e,t,s)=>{"use strict";s.d(t,{A:()=>a,z:()=>n});var r=s(96330);let n=globalThis.prisma??new r.PrismaClient({log:["error"]});process.on("beforeExit",async()=>{await n.$disconnect()});let a=n},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12412:e=>{"use strict";e.exports=require("assert")},14985:e=>{"use strict";e.exports=require("dns")},21820:e=>{"use strict";e.exports=require("os")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},34631:e=>{"use strict";e.exports=require("tls")},36781:(e,t,s)=>{"use strict";s.d(t,{PP:()=>u,xC:()=>c});var r=s(70300),n=s.n(r);let a={host:process.env.REDIS_HOST||"localhost",port:parseInt(process.env.REDIS_PORT||"6379"),password:process.env.REDIS_PASSWORD,maxRetriesPerRequest:3,retryDelayOnFailover:100,enableReadyCheck:!0,lazyConnect:!0};class i{static{this.instance=null}static{this.isConnected=!1}static getInstance(){return this.instance||(this.instance=new(n())(a),this.instance.on("connect",()=>{this.isConnected=!0}),this.instance.on("error",e=>{console.error("âŒ Redis error:",e.message),this.isConnected=!1}),this.instance.on("close",()=>{this.isConnected=!1})),this.instance}static async connect(){try{let e=this.getInstance();return await e.connect(),!0}catch{return console.warn("Redis connection failed, using fallback cache"),!1}}static getConnectionStatus(){return this.isConnected}}let o=i.getInstance(),u={async get(e){try{let t=await o.get(e);return t?JSON.parse(t):null}catch{return null}},async set(e,t,s=3600){try{return await o.setex(e,s,JSON.stringify(t)),!0}catch{return!1}},async del(e){try{return await o.del(e),!0}catch{return!1}},async invalidatePattern(e){try{let t=await o.keys(e);t.length>0&&await o.del(...t)}catch{console.error("Failed to invalidate cache pattern:",e)}},async getOrSet(e,t,s=3600){let r=await this.get(e);if(null!==r)return r;let n=await t();return await this.set(e,n,s),n}},c={async checkLimit(e,t,s){let r=Date.now(),n=`ratelimit:${e}:${Math.floor(r/(1e3*s))}`;try{let e=await o.incr(n);1===e&&await o.expire(n,s);let a=Math.max(0,t-e),i=Math.ceil(r/(1e3*s))*s*1e3;return{allowed:e<=t,remaining:a,resetAt:i}}catch{return{allowed:!0,remaining:t,resetAt:r+1e3*s}}}}},41204:e=>{"use strict";e.exports=require("string_decoder")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45740:(e,t,s)=>{"use strict";s.d(t,{Ng:()=>f,nM:()=>p,vF:()=>d});var r=s(91728),n=s.n(r);let{combine:a,timestamp:i,printf:o,colorize:u,errors:c}=n().format,l=o(({level:e,message:t,timestamp:s,stack:r,...n})=>{let a=`${s} [${e}]: ${t}`;return Object.keys(n).length>0&&(a+=` ${JSON.stringify(n)}`),r&&(a+=`
${r}`),a}),d=n().createLogger({level:process.env.LOG_LEVEL||"info",format:a(c({stack:!0}),i({format:"YYYY-MM-DD HH:mm:ss"}),l),defaultMeta:{service:"studystreak"},transports:[new(n()).transports.Console({format:a(u({all:!0}),l)})]});d.add(new(n()).transports.File({filename:"logs/error.log",level:"error",maxsize:5242880,maxFiles:5})),d.add(new(n()).transports.File({filename:"logs/combined.log",maxsize:5242880,maxFiles:5}));let p=(e,t,s,r)=>{d.info("AI Request",{action:e,model:t,tokens:s,duration:r?`${r}ms`:void 0})},f=(e,t,s)=>{d[t>1e3?"warn":"info"]("Performance",{operation:e,duration:`${t}ms`,slow:t>1e3,...s})}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},57729:()=>{},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81310:(e,t,s)=>{"use strict";s.d(t,{BE:()=>l,Er:()=>c,HU:()=>d,Ht:()=>f,nr:()=>p});var r=s(85663),n=s(43205),a=s.n(n),i=s(44999),o=s(36781);let u=process.env.JWT_SECRET||"your-super-secret-jwt-key-change-in-production";async function c(e){return r.Ay.hash(e,12)}async function l(e,t){return r.Ay.compare(e,t)}function d(e){return a().sign(e,u,{expiresIn:"7d"})}function p(e){try{return a().verify(e,u)}catch{return null}}async function f(){let e=await (0,i.UL)(),t=e.get("auth-token")?.value;return!t||await o.PP.get(`blacklist:${t}`)?null:p(t)}},81630:e=>{"use strict";e.exports=require("http")},83997:e=>{"use strict";e.exports=require("tty")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[447,475,999,315,300],()=>s(2206));module.exports=r})();