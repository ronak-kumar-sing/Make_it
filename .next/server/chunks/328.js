"use strict";exports.id=328,exports.ids=[328],exports.modules={34833:(e,r,t)=>{var n=Object.create,o=Object.defineProperty,i=Object.getOwnPropertyDescriptor,l=Object.getOwnPropertyNames,a=Object.getPrototypeOf,c=Object.prototype.hasOwnProperty,s=(e,r,t,n)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let a of l(r))c.call(e,a)||a===t||o(e,a,{get:()=>r[a],enumerable:!(n=i(r,a))||n.enumerable});return e},u=(e,r,t)=>(t=null!=e?n(a(e)):{},s(!r&&e&&e.__esModule?t:o(t,"default",{value:e,enumerable:!0}),e)),f={};((e,r)=>{for(var t in r)o(e,t,{get:r[t],enumerable:!0})})(f,{isValidAccessToken:()=>g,readAuthConfig:()=>w,writeAuthConfig:()=>O}),e.exports=s(o({},"__esModule",{value:!0}),f);var p=u(t(29021)),d=u(t(33873)),y=t(85848);function h(){let e=(0,y.getVercelDataDir)();if(!e)throw Error(`Unable to find Vercel CLI data directory. Your platform: ${process.platform}. Supported: darwin, linux, win32.`);return d.join(e,"auth.json")}function w(){try{let e=h();if(!p.existsSync(e))return null;let r=p.readFileSync(e,"utf8");if(!r)return null;return JSON.parse(r)}catch(e){return null}}function O(e){let r=h(),t=d.dirname(r);p.existsSync(t)||p.mkdirSync(t,{mode:504,recursive:!0}),p.writeFileSync(r,JSON.stringify(e,null,2),{mode:384})}function g(e){if(!e.token)return!1;if("number"!=typeof e.expiresAt)return!0;let r=Math.floor(Date.now()/1e3);return e.expiresAt>=r}},40341:(e,r,t)=>{var n=Object.defineProperty,o=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,l=Object.prototype.hasOwnProperty,a={};((e,r)=>{for(var t in r)n(e,t,{get:r[t],enumerable:!0})})(a,{processTokenResponse:()=>d,refreshTokenRequest:()=>p}),e.exports=((e,r,t,a)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let t of i(r))l.call(e,t)||void 0===t||n(e,t,{get:()=>r[t],enumerable:!(a=o(r,t))||a.enumerable});return e})(n({},"__esModule",{value:!0}),a);var c=t(21820);let s=`@vercel/oidc node-${process.version} ${(0,c.platform)()} (${(0,c.arch)()}) ${(0,c.hostname)()}`,u=null;async function f(){if(u)return u;let e=await fetch("https://vercel.com/.well-known/openid-configuration",{headers:{"user-agent":s}});if(!e.ok)throw Error("Failed to discover OAuth endpoints");let r=await e.json();if(!r||"string"!=typeof r.token_endpoint)throw Error("Invalid OAuth discovery response");let t=r.token_endpoint;return u=t,t}async function p(e){let r=await f();return await fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","user-agent":s},body:new URLSearchParams({client_id:"cl_HYyOPBNtFMfHhaUn9L4QPfTZz6TP47bp",grant_type:"refresh_token",...e})})}async function d(e){let r=await e.json();return e.ok?"object"!=typeof r||null===r?[Error("Invalid token response")]:"string"!=typeof r.access_token?[Error("Missing access_token in response")]:"Bearer"!==r.token_type?[Error("Invalid token_type in response")]:"number"!=typeof r.expires_in?[Error("Missing expires_in in response")]:[null,r]:[Error("object"==typeof r&&r&&"error"in r?String(r.error):"Token refresh failed")]}},45476:(e,r,t)=>{var n=Object.create,o=Object.defineProperty,i=Object.getOwnPropertyDescriptor,l=Object.getOwnPropertyNames,a=Object.getPrototypeOf,c=Object.prototype.hasOwnProperty,s=(e,r,t,n)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let a of l(r))c.call(e,a)||a===t||o(e,a,{get:()=>r[a],enumerable:!(n=i(r,a))||n.enumerable});return e},u=(e,r,t)=>(t=null!=e?n(a(e)):{},s(!r&&e&&e.__esModule?t:o(t,"default",{value:e,enumerable:!0}),e)),f={};((e,r)=>{for(var t in r)o(e,t,{get:r[t],enumerable:!0})})(f,{findRootDir:()=>w,getUserDataDir:()=>O}),e.exports=s(o({},"__esModule",{value:!0}),f);var p=u(t(33873)),d=u(t(29021)),y=u(t(21820)),h=t(65372);function w(){try{let e=process.cwd();for(;e!==p.default.dirname(e);){let r=p.default.join(e,".vercel");if(d.default.existsSync(r))return e;e=p.default.dirname(e)}}catch(e){throw new h.VercelOidcTokenError("Token refresh only supported in node server environments")}return null}function O(){if(process.env.XDG_DATA_HOME)return process.env.XDG_DATA_HOME;switch(y.default.platform()){case"darwin":return p.default.join(y.default.homedir(),"Library/Application Support");case"linux":return p.default.join(y.default.homedir(),".local/share");case"win32":if(process.env.LOCALAPPDATA)return process.env.LOCALAPPDATA;return null;default:return null}}},85848:(e,r,t)=>{var n=Object.create,o=Object.defineProperty,i=Object.getOwnPropertyDescriptor,l=Object.getOwnPropertyNames,a=Object.getPrototypeOf,c=Object.prototype.hasOwnProperty,s=(e,r,t,n)=>{if(r&&"object"==typeof r||"function"==typeof r)for(let a of l(r))c.call(e,a)||a===t||o(e,a,{get:()=>r[a],enumerable:!(n=i(r,a))||n.enumerable});return e},u=(e,r,t)=>(t=null!=e?n(a(e)):{},s(!r&&e&&e.__esModule?t:o(t,"default",{value:e,enumerable:!0}),e)),f={};((e,r)=>{for(var t in r)o(e,t,{get:r[t],enumerable:!0})})(f,{assertVercelOidcTokenResponse:()=>j,findProjectInfo:()=>m,getTokenPayload:()=>P,getVercelCliToken:()=>k,getVercelDataDir:()=>g,getVercelOidcToken:()=>v,isExpired:()=>_,loadToken:()=>T,saveToken:()=>b}),e.exports=s(o({},"__esModule",{value:!0}),f);var p=u(t(33873)),d=u(t(29021)),y=t(65372),h=t(45476),w=t(34833),O=t(40341);function g(){let e=(0,h.getUserDataDir)();return e?p.join(e,"com.vercel.cli"):null}async function k(){let e=(0,w.readAuthConfig)();if(!e)return null;if((0,w.isValidAccessToken)(e))return e.token||null;if(!e.refreshToken)return(0,w.writeAuthConfig)({}),null;try{let r=await (0,O.refreshTokenRequest)({refresh_token:e.refreshToken}),[t,n]=await (0,O.processTokenResponse)(r);if(t||!n)return(0,w.writeAuthConfig)({}),null;let o={token:n.access_token,expiresAt:Math.floor(Date.now()/1e3)+n.expires_in};return n.refresh_token&&(o.refreshToken=n.refresh_token),(0,w.writeAuthConfig)(o),o.token??null}catch(e){return(0,w.writeAuthConfig)({}),null}}async function v(e,r,t){let n=`https://api.vercel.com/v1/projects/${r}/token?source=vercel-oidc-refresh${t?`&teamId=${t}`:""}`,o=await fetch(n,{method:"POST",headers:{Authorization:`Bearer ${e}`}});if(!o.ok)throw new y.VercelOidcTokenError(`Failed to refresh OIDC token: ${o.statusText}`);let i=await o.json();return j(i),i}function j(e){if(!e||"object"!=typeof e)throw TypeError("Vercel OIDC token is malformed. Expected an object. Please run `vc env pull` and try again");if(!("token"in e)||"string"!=typeof e.token)throw TypeError("Vercel OIDC token is malformed. Expected a string-valued token property. Please run `vc env pull` and try again")}function m(){let e=(0,h.findRootDir)();if(!e)throw new y.VercelOidcTokenError("Unable to find project root directory. Have you linked your project with `vc link?`");let r=p.join(e,".vercel","project.json");if(!d.existsSync(r))throw new y.VercelOidcTokenError("project.json not found, have you linked your project with `vc link?`");let t=JSON.parse(d.readFileSync(r,"utf8"));if("string"!=typeof t.projectId&&"string"!=typeof t.orgId)throw TypeError("Expected a string-valued projectId property. Try running `vc link` to re-link your project.");return{projectId:t.projectId,teamId:t.orgId}}function b(e,r){let t=(0,h.getUserDataDir)();if(!t)throw new y.VercelOidcTokenError("Unable to find user data directory. Please reach out to Vercel support.");let n=p.join(t,"com.vercel.token",`${r}.json`),o=JSON.stringify(e);d.mkdirSync(p.dirname(n),{mode:504,recursive:!0}),d.writeFileSync(n,o),d.chmodSync(n,432)}function T(e){let r=(0,h.getUserDataDir)();if(!r)throw new y.VercelOidcTokenError("Unable to find user data directory. Please reach out to Vercel support.");let t=p.join(r,"com.vercel.token",`${e}.json`);if(!d.existsSync(t))return null;let n=JSON.parse(d.readFileSync(t,"utf8"));return j(n),n}function P(e){let r=e.split(".");if(3!==r.length)throw new y.VercelOidcTokenError("Invalid token. Please run `vc env pull` and try again");let t=r[1].replace(/-/g,"+").replace(/_/g,"/"),n=t.padEnd(t.length+(4-t.length%4)%4,"=");return JSON.parse(Buffer.from(n,"base64").toString("utf8"))}function _(e){return 1e3*e.exp<Date.now()}}};